{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "title": "Product Data Schema",
    "description": "Schema for the output JSON files generated by grocery parsers (Tesco, Kupi).",
    "type": "object",
    "required": [
        "products",
        "metadata"
    ],
    "properties": {
        "products": {
            "type": "array",
            "items": {
                "$ref": "#/definitions/Product"
            }
        },
        "metadata": {
            "$ref": "#/definitions/Metadata"
        }
    },
    "definitions": {
        "Product": {
            "type": "object",
            "required": [
                "name",
                "categories",
                "prices"
            ],
            "properties": {
                "name": {
                    "type": "string",
                    "description": "The name of the product"
                },
                "brand": {
                    "type": [
                        "string",
                        "null"
                    ],
                    "description": "The brand of the product"
                },
                "product_url": {
                    "type": [
                        "string",
                        "null"
                    ],
                    "description": "The original URL of the product details page"
                },
                "image_url": {
                    "type": [
                        "string",
                        "null"
                    ],
                    "description": "URL of the product image"
                },
                "categories": {
                    "type": "array",
                    "items": {
                        "type": "string"
                    },
                    "description": "Hierarchical list of categories belonging to the product"
                },
                "ai_cats": {
                    "type": "array",
                    "items": {
                        "type": "string"
                    },
                    "description": "AI-derived categories (e.g. 'Protein > Legumes')"
                },
                "category_ids": {
                    "type": "array",
                    "items": {
                        "type": "string"
                    },
                    "description": "Stable IDs of categories in the path"
                },
                "prices": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/PriceOffer"
                    },
                    "description": "List of price offers available for this product"
                }
            }
        },
        "PriceOffer": {
            "type": "object",
            "required": [
                "store_name",
                "price"
            ],
            "properties": {
                "store_name": {
                    "type": "string",
                    "description": "Name of the store offering the product"
                },
                "price": {
                    "type": [
                        "number",
                        "null"
                    ],
                    "description": "Current selling price"
                },
                "original_price": {
                    "type": [
                        "number",
                        "null"
                    ],
                    "description": "Original price before discount (if applicable)"
                },
                "discount_pct": {
                    "type": [
                        "number",
                        "null"
                    ],
                    "description": "Percentage of discount"
                },
                "unit_price": {
                    "type": [
                        "number",
                        "null"
                    ],
                    "description": "Price per unit (calculated)"
                },
                "unit": {
                    "type": [
                        "string",
                        "null"
                    ],
                    "description": "Unit of measure (e.g., '100g', 'kg', 'l')"
                },
                "package_size": {
                    "type": [
                        "string",
                        "null"
                    ],
                    "description": "Size of the package (e.g. '500 ml')"
                },
                "condition": {
                    "type": [
                        "string",
                        "null"
                    ],
                    "description": "Conditions for the price (e.g. 'Clubcard', '2+1')"
                },
                "validity": {
                    "type": [
                        "string",
                        "null"
                    ],
                    "description": "human readable validity string"
                },
                "validity_start": {
                    "type": [
                        "string",
                        "null"
                    ],
                    "format": "date",
                    "description": "Start date of the offer validity (ISO 8601)"
                },
                "validity_end": {
                    "type": [
                        "string",
                        "null"
                    ],
                    "format": "date",
                    "description": "End date of the offer validity (ISO 8601)"
                },
                "product_id": {
                    "type": [
                        "string",
                        "null"
                    ]
                },
                "shop_id": {
                    "type": [
                        "string",
                        "null"
                    ]
                },
                "discount_id": {
                    "type": [
                        "string",
                        "null"
                    ]
                }
            }
        },
        "Metadata": {
            "type": "object",
            "required": [
                "total_products",
                "generated_at",
                "stores"
            ],
            "properties": {
                "total_products": {
                    "type": "integer",
                    "description": "Total number of unique products in the feed"
                },
                "generated_at": {
                    "type": "string",
                    "format": "date-time",
                    "description": "Timestamp of generation"
                },
                "stores": {
                    "type": "object",
                    "additionalProperties": {
                        "type": "integer"
                    },
                    "description": "Count of products/offers per store"
                },
                "categories": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/CategoryNode"
                    },
                    "description": "Hierarchical list of categories"
                },
                "brands": {
                    "type": "object",
                    "additionalProperties": {
                        "type": "integer"
                    },
                    "description": "Count of products per brand"
                }
            }
        },
        "CategoryNode": {
            "type": "object",
            "required": [
                "id",
                "name",
                "count",
                "children"
            ],
            "properties": {
                "id": {
                    "type": "string"
                },
                "name": {
                    "type": "string"
                },
                "count": {
                    "type": "integer"
                },
                "children": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/CategoryNode"
                    }
                }
            }
        }
    }
}